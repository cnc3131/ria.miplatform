<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="form_HttpMultiPart" Left="8" PidAttrib="7" Top="8" Ver="1.0" Width="1000" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" FireNextCount="10" Id="Dataset0">
				<Contents>
					<colinfo id="custSeqNo" size="22" type="STRING"/>
					<colinfo id="name" size="50" type="STRING"/>
					<colinfo id="sex" size="1" type="STRING"/>
					<colinfo id="age" size="3" type="INT"/>
					<colinfo id="registNo1" size="6" type="STRING"/>
					<colinfo id="registNo2" size="7" type="STRING"/>
					<colinfo id="birthDay" size="8" type="STRING"/>
					<colinfo id="riskGrade" size="14" type="STRING"/>
					<colinfo id="drivingYn" size="2" type="STRING"/>
					<colinfo id="smokingYn" size="2" type="STRING"/>
					<colinfo id="familySeqNo" size="22" type="STRING"/>
					<colinfo id="familyRelationCode" size="2" type="STRING"/>
					<colinfo id="registryDate" size="16" type="STRING"/>
					<colinfo id="level" size="1" type="STRING"/>
					<colinfo id="img" size="1" type="STRING"/>
					<colinfo id="cimg" size="1" type="STRING"/>
					<colinfo id="eimg" size="1" type="STRING"/>
					<colinfo id="context" size="50" type="STRING"/>
					<colinfo id="ret" size="1" type="STRING"/>
					<colinfo id="filename" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="Dataset1">
				<Contents>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="fullname" size="256" summ="default" type="STRING"/>
					<colinfo id="filename" size="256" summ="default" type="STRING"/>
					<colinfo id="prog_bar" size="256" summ="default" type="STRING"/>
					<colinfo id="filesize" size="256" summ="default" type="INT"/>
					<colinfo id="progsize" size="256" summ="default" type="STRING"/>
					<colinfo id="sfnm" size="256" summ="default" type="STRING"/>
					<colinfo id="sfFullNm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Image FillType="STRETCH" Height="600" Id="Image10" ImageID="M_bg3" LeftMargin="0" TabOrder="7" Width="1000"></Image>
		<Button Height="34" Id="Button0" Left="802" OnClick="Button0_OnClick" TabOrder="6" Text="첨부파일&#32;올리기(Multipart)" Top="544" Width="158"></Button>
		<FileDialog Bottom="120" Height="24" Id="FileDlg" Left="16" MultiSelect="TRUE" Right="40" TabOrder="4" Top="96" Width="24"></FileDialog>
		<multipart_http Height="24" Id="multipart_http0" Left="16" Top="72" Width="24"></multipart_http>
		<Button Height="34" Id="Button1" Left="640" OnClick="Button1_OnClick" TabOrder="1" Text="파일선택" Top="240" Width="158"></Button>
		<Grid AutoFit="TRUE" BindDataset="Dataset1" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="user2" Bottom="232" Editable="TRUE" Enable="true" EndLineColor="default" Height="160" Id="Grid0" InputPanel="FALSE" Left="40" LineColor="default" MinWidth="100" OnCellDBLClick="Grid0_OnCellDblClick" Right="960" RowHeight="30" Style="st_grid" TabOrder="3" TabStop="true" Top="72" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="default" WheelScrollRow="1" Width="920">
			<contents>
				<format id="Default">
					<columns>
						<col width="113"/>
						<col width="185"/>
						<col width="263"/>
						<col width="56"/>
						<col width="88"/>
					</columns>
					<head>
						<cell col="0" display="text" text="filename"/>
						<cell col="1" display="text" text="prog_bar"/>
						<cell col="2" display="text" text="ServerPath"/>
						<cell col="3" display="text"/>
						<cell col="4" display="text"/>
					</head>
					<body>
						<cell col="0" colid="filename" display="text"/>
						<cell align="left" col="1" colid="prog_bar" color="red" display="bar"/>
						<cell col="2" colid="sfFullNm" display="text" edit="normal"/>
						<cell align="center" col="3" colid="filesize" display="text" expr='progsize+&quot;/&quot;&#32;+&#32;filesize'/>
						<cell align="center" col="4" display="button" text="Download"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Height="34" Id="Button2" Left="802" OnClick="Button2_OnClick" TabOrder="4" Text="첨부파일&#32;올리기" Top="240" Width="158"></Button>
		<Grid AutoFit="TRUE" BindDataset="Dataset0" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="user2" Bottom="536" Editable="TRUE" Enable="true" EndLineColor="default" Height="136" Id="Grid1" InputPanel="FALSE" Left="40" LineColor="default" MinWidth="100" Right="960" RowHeight="30" Style="st_grid" TabOrder="5" TabStop="true" Top="400" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="default" WheelScrollRow="1" Width="920">
			<contents>
				<format id="Default">
					<columns>
						<col width="528"/>
					</columns>
					<head>
						<cell col="0" display="text" text="filename"/>
					</head>
					<body>
						<cell col="0" colid="filename" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Height="34" Id="Button3" Left="640" OnClick="Button3_OnClick" TabOrder="6" Text="파일선택(MultiPart)" Top="544" Width="158"></Button>
		<Image FillType="STRETCH" Height="50" Id="Image0" ImageID="title_bg" Left="15" TabOrder="8" Top="16" Width="967"></Image>
		<Static Color="whitesmoke" Font="굴림,12,Bold" Height="29" Id="Static0" Left="34" TabOrder="9" Text="파일업로드" Top="21" VAlign="Middle" Width="168"></Static>
	</Form>
	<Script><![CDATA[#include "lib::fileupdown.js"

///////////////////////////////
//                           //
//      멀티파트 테스트      //
//                           //
///////////////////////////////
var multipartUrl = "http://localhost:8080/web/file.defaultUpload.mip";
//멀티파일 선택 
function Button3_OnClick(obj)
{
	if(!FileDlg.Open()) return;
	var strFileName = FileDlg.FilePath + "\\"; 
	array = FileDlg.FileNameList;

	for( i=0; i<array.length; i++ ){
		Dataset0.addRow();
		Dataset0.SetColumn(Dataset0.row,"filename",strFileName + "\\" + array[i]);
	}	
}

//멀티파일 업로드
function Button0_OnClick(obj)
{
	multipart_http0.MultiInit(); // 시작전에 초기화 처리

	// 폼변수 전송
	multipart_http0.MultiAddArguments("userName", "폼변수", false); // 폼변수:false
	// 데이터셋 넘기기
	multipart_http0.MultiAddArguments("xmldata", Dataset0.SaveXML(), false); // 폼변수:false
	// 파일 업로드
	//objHttpFIle.MultiAddArguments("file1", strFileFullName, true);
    //strFileFullName 값은 로칼 파일 경로 + 파일명 이고 마지막 Argument가 True임	
	for( i=0; i<Dataset0.rowcount; i++ )
	{
		multipart_http0.MultiAddArguments("upfile", Dataset0.GetColumn(i,"filename"),true); //파일:true
	}

	var rtn = multipart_http0.MultiRequest(multipartUrl);
	//호출 성공 여부 
	if ( rtn == 1 ){
		// 서버의 성공/실패 결과값을 받고싶으면 ErrorMsg로 전송받아 처리한다.
		//alert("rtn == 1 , "+ multipart_http0.ErrorMsg);
		trace(multipart_http0.StatCode);
	}
	else{
		trace(multipart_http0.StatCode);
	} 
				
}

//파일 선택 
function Button1_OnClick(obj)
{
	FileDlg.Open();
	
	Dataset1.addRow();
	Dataset1.SetColumn(Dataset1.row,"fullname",FileDlg.FilePath + "\\" + FileDlg.FileName);
	Dataset1.SetColumn(Dataset1.row,"filename",FileDlg.FileName);		
}

//파일 업로드
function Button2_OnClick(obj)
{
	var ret;
	var sServerFilePath 		= "upTest";
	
	for ( var i = 0 ; i < Dataset1.rowcount ; i++ )
	{
		var str_param = Dataset1.getColumn(i,"filename");
		ret = gfn_FileWrite(multipart_http0,Dataset1.getColumn(i,"filename"), str_param, i, "prog_bar", grid0);
trace("return OK ========"+ret);
		if( ret[0]=="succ" ) {
			Dataset1.SetColumn(i, "sfnm", ret[1]);
			Dataset1.SetColumn(i, "sfFullNm", "default/"+Dataset1.getColumn(i,"filename"));
			alert("success" + " : group : " + ret[2]);
		} else {
			alert(ret[0]);
		}
	}
}

//파일 다운로드
function Grid0_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	var sUrl 		= "http://localhost:8080/web/file.defaultDownload.mip";
	var sServerFileFullName = dataset1.GetColumn(dataset1.row, "sfFullNm");
	var sLocalFileFullName = dataset1.GetColumn(dataset1.row, "filename");

trace("sServerFileFullName================>"+sServerFileFullName);	
trace("sLocalFileFullName================>"+sLocalFileFullName);
trace(dataset1.SaveXML());	

	var ret = gfn_FileRead(multipart_http0, "c:\\Temp\\" + sLocalFileFullName, sServerFileFullName, dataset0.getColumn(nRow,"filesize"),nRow, "prog_bar", grid0);
trace(ret);
	if ( ret[0] == "FAIL" )
	{
		alert(ret[1]);
	}	
	else
	{
		alert("c:\\Temp\\" + sLocalFileFullName + " 파일이 다운로드되었습니다.");
	}
}




]]></Script>
</Window>